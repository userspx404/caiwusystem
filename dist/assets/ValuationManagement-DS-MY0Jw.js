import{a as b,r as F,o as O,b as i,c as E,d as y,e as n,f as t,g as o,w as a,u as M,i as T,z as U,H as V,t as r,E as _}from"./index-CAVot8kD.js";import{_ as j,g as P}from"./_plugin-vue_export-helper-CZBBfLPA.js";const q={class:"valuation-management",style:{padding:"20px"}},H={class:"page-header"},G={class:"page-title"},J={style:{display:"flex","justify-content":"space-between","align-items":"center"}},K={key:0,style:{"margin-top":"20px"}},Q={class:"amount-text"},W={__name:"ValuationManagement",setup(X){const g=b(!1),m=b(null),s=b(null),p=F({valuationDate:new Date().toISOString().split("T")[0]}),z={valuationDate:[{required:!0,message:"请选择估值日期",trigger:"change"}]},C=l=>l==null?"0.00":Number(l).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),N=l=>l?typeof l=="string"?l:new Date(l).toLocaleDateString("zh-CN"):"-",S=l=>({DRAFT:"info",AUDITED:"warning",POSTED:"success",CANCELLED:"danger"})[l]||"",k=l=>({DRAFT:"草稿",AUDITED:"已审核",POSTED:"已过账",CANCELLED:"已作废"})[l]||l,A=async()=>{if(m.value)try{await m.value.validate(),g.value=!0,s.value=null;const l={valuationDate:p.valuationDate},e=await P.performValuation(l);e?(s.value=e,_.success("外币估值调整完成！")):_.info("当前无需进行估值调整（无外币余额或汇率无变化）")}catch(l){l!==!1&&(console.error("执行估值失败:",l),l.status===204?_.info("当前无需进行估值调整"):_.error(l.message||"执行估值失败，请检查后端服务是否启动"))}finally{g.value=!1}},I=()=>{var l;p.valuationDate=new Date().toISOString().split("T")[0],s.value=null,(l=m.value)==null||l.clearValidate()};return O(()=>{console.log("ValuationManagement 组件已挂载")}),(l,e)=>{const D=i("el-icon"),Y=i("el-date-picker"),x=i("el-form-item"),w=i("el-button"),R=i("el-form"),v=i("el-card"),f=i("el-tag"),c=i("el-descriptions-item"),B=i("el-descriptions"),u=i("el-table-column"),L=i("el-table"),h=i("el-alert");return y(),E("div",q,[n("div",H,[n("h1",G,[t(D,{class:"title-icon"},{default:a(()=>[t(M(T))]),_:1}),e[1]||(e[1]=o(" 外币估值 ",-1))]),e[2]||(e[2]=n("p",{class:"page-subtitle"},"对外币账户进行估值调整，生成估值调整凭证",-1))]),t(v,{class:"main-card",shadow:"hover"},{header:a(()=>[...e[3]||(e[3]=[n("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[n("span",{style:{"font-size":"18px","font-weight":"600"}},"外币估值调整")],-1)])]),default:a(()=>[t(v,{class:"form-card",shadow:"never",style:{"margin-bottom":"20px"}},{default:a(()=>[t(R,{ref_key:"formRef",ref:m,model:p,rules:z,"label-width":"140px"},{default:a(()=>[t(x,{label:"估值日期",prop:"valuationDate"},{default:a(()=>[t(Y,{modelValue:p.valuationDate,"onUpdate:modelValue":e[0]||(e[0]=d=>p.valuationDate=d),type:"date",placeholder:"选择估值日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"300px"}},null,8,["modelValue"]),e[4]||(e[4]=n("div",{style:{"margin-top":"5px",color:"#909399","font-size":"12px"}}," 系统将根据该日期的汇率对外币账户进行估值调整 ",-1))]),_:1}),t(x,null,{default:a(()=>[t(w,{type:"primary",onClick:A,loading:g.value,size:"large"},{default:a(()=>[t(D,null,{default:a(()=>[t(M(T))]),_:1}),e[5]||(e[5]=o(" 执行外币估值 ",-1))]),_:1},8,["loading"]),t(w,{onClick:I},{default:a(()=>[...e[6]||(e[6]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s.value?(y(),U(v,{key:0,class:"result-card",shadow:"never"},{header:a(()=>[n("div",J,[e[8]||(e[8]=n("span",{style:{"font-size":"16px","font-weight":"600"}},"估值调整结果",-1)),t(f,{type:"success",size:"large"},{default:a(()=>[...e[7]||(e[7]=[o("估值完成",-1)])]),_:1})])]),default:a(()=>[t(B,{column:2,border:""},{default:a(()=>[t(c,{label:"凭证ID"},{default:a(()=>[t(f,{type:"success",size:"large"},{default:a(()=>[o("#"+r(s.value.id),1)]),_:1})]),_:1}),t(c,{label:"凭证号码"},{default:a(()=>[o(r(s.value.voucherNo||"-"),1)]),_:1}),t(c,{label:"凭证日期"},{default:a(()=>[o(r(N(s.value.date)),1)]),_:1}),t(c,{label:"状态"},{default:a(()=>[t(f,{type:S(s.value.status)},{default:a(()=>[o(r(k(s.value.status)),1)]),_:1},8,["type"])]),_:1}),t(c,{label:"摘要",span:2},{default:a(()=>[o(r(s.value.description||"外币估值调整"),1)]),_:1})]),_:1}),s.value.splits&&s.value.splits.length>0?(y(),E("div",K,[e[9]||(e[9]=n("h3",{style:{"margin-bottom":"15px","font-size":"16px",color:"#303133"}},"凭证分录",-1)),t(L,{data:s.value.splits,border:"",style:{width:"100%"}},{default:a(()=>[t(u,{type:"index",label:"序号",width:"60"}),t(u,{prop:"accountCode",label:"科目代码",width:"120"}),t(u,{prop:"accountName",label:"科目名称","min-width":"200"}),t(u,{prop:"balanceDirection",label:"方向",width:"100"},{default:a(({row:d})=>[t(f,{type:d.balanceDirection==="DEBIT"?"success":"warning",size:"small"},{default:a(()=>[o(r(d.balanceDirection==="DEBIT"?"借方":"贷方"),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"amount",label:"金额",width:"150",align:"right"},{default:a(({row:d})=>[n("span",Q,r(C(d.amount)),1)]),_:1}),t(u,{prop:"description",label:"摘要","min-width":"200"})]),_:1},8,["data"])])):V("",!0),t(h,{type:"success",closable:!1,style:{"margin-top":"15px"}},{title:a(()=>[n("div",null,[e[10]||(e[10]=n("strong",null,"估值调整完成！",-1)),e[11]||(e[11]=n("br",null,null,-1)),o(" 已生成估值调整凭证 #"+r(s.value.id)+"，请前往「凭证管理」查看详情。 ",1)])]),_:1})]),_:1})):V("",!0),t(h,{type:"info",closable:!1,style:{"margin-top":"20px"}},{title:a(()=>[...e[12]||(e[12]=[n("div",{style:{"font-size":"14px","line-height":"1.6"}},[n("strong",null,"使用说明："),n("br"),o(" 1. 选择估值日期，系统将根据该日期的汇率对外币账户进行估值"),n("br"),o(" 2. 点击「执行外币估值」按钮，系统会自动计算汇率差异并生成调整凭证"),n("br"),o(" 3. 如果无需调整（如无外币余额或汇率无变化），系统将不生成凭证"),n("br"),o(" 4. 生成的调整凭证可以在「凭证管理」中查看和管理 ")],-1)])]),_:1})]),_:1})])}}},ee=j(W,[["__scopeId","data-v-a211a770"]]);export{ee as default};
