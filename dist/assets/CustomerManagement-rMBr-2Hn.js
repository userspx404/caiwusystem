import{a as b,r as q,n as te,o as le,b as n,p as ae,c as F,d as x,f as e,w as a,q as se,v as T,u as c,x as U,g as d,y as re,z,e as f,t as C,G as oe,l as ne,A as ue,k as ie,B as de,H as me,E as _,D as ce}from"./index-CAVot8kD.js";import{_ as pe,c as w}from"./_plugin-vue_export-helper-CZBBfLPA.js";const fe={class:"customer-management"},_e={class:"card-header"},ge={class:"header-left"},be={class:"amount-text"},ve={key:1,class:"text-muted"},ye={class:"dialog-footer"},xe={__name:"CustomerManagement",setup(Ce){const V=b([]),v=b(!1),g=b(!1),I=b("新增客戶"),k=b(!1),N=b(null),o=q({customerName:"",taxId:"",status:""}),r=q({id:null,customerName:"",taxId:"",creditLimit:0,currentBalance:0,settlementCurrency:"",status:"有效"}),$={customerName:[{required:!0,message:"請輸入客戶名稱",trigger:"blur"},{min:2,max:150,message:"長度在 2 到 150 個字符",trigger:"blur"}],taxId:[{max:50,message:"長度不能超過 50 個字符",trigger:"blur"}],creditLimit:[{required:!0,message:"請輸入信用額度",trigger:"blur"},{type:"number",min:0,message:"信用額度必須大於或等於 0",trigger:"blur"}],settlementCurrency:[{max:10,message:"長度不能超過 10 個字符",trigger:"blur"}],status:[{required:!0,message:"請選擇狀態",trigger:"change"}]},K=te(()=>{let l=V.value;return o.customerName&&(l=l.filter(t=>{var u;return(u=t.customerName)==null?void 0:u.toLowerCase().includes(o.customerName.toLowerCase())})),o.taxId&&(l=l.filter(t=>{var u;return(u=t.taxId)==null?void 0:u.toLowerCase().includes(o.taxId.toLowerCase())})),o.status&&(l=l.filter(t=>t.status===o.status)),l}),A=l=>l==null?"0.00":Number(l).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),j=l=>{if(l==null)return"amount-text";const t=Number(l);return t>0?"amount-text positive":t<0?"amount-text negative":"amount-text"},B=async()=>{v.value=!0;try{const l=await w.getAllCustomers();V.value=Array.isArray(l)?l:[],_.success("客戶列表加載成功")}catch(l){console.error("獲取客戶列表失敗:",l),_.error(l.message||"獲取客戶列表失敗"),V.value=[]}finally{v.value=!1}},L=()=>{},O=()=>{o.customerName="",o.taxId="",o.status=""},G=()=>{I.value="新增客戶",P(),g.value=!0},H=l=>{I.value="編輯客戶",Object.assign(r,{id:l.id,customerName:l.customerName||"",taxId:l.taxId||"",creditLimit:l.creditLimit?Number(l.creditLimit):0,currentBalance:l.currentBalance?Number(l.currentBalance):0,settlementCurrency:l.settlementCurrency||"",status:l.status||"有效"}),g.value=!0},Y=async l=>{try{await ce.confirm(`確定要刪除客戶「${l.customerName}」嗎？此操作不可恢復。`,"確認刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}),v.value=!0,await w.deleteCustomer(l.id),_.success("刪除成功"),await B()}catch(t){t!=="cancel"&&(console.error("刪除客戶失敗:",t),_.error(t.message||"刪除客戶失敗"))}finally{v.value=!1}},J=async()=>{if(N.value)try{await N.value.validate(),k.value=!0;const l={customerName:r.customerName,taxId:r.taxId||null,creditLimit:r.creditLimit,settlementCurrency:r.settlementCurrency||null,status:r.status};r.id?(await w.updateCustomer(r.id,l),_.success("更新成功")):(await w.createCustomer(l),_.success("新增成功")),g.value=!1,await B()}catch(l){l!==!1&&(console.error("提交失敗:",l),_.error(l.message||"提交失敗"))}finally{k.value=!1}},P=()=>{var l;Object.assign(r,{id:null,customerName:"",taxId:"",creditLimit:0,currentBalance:0,settlementCurrency:"",status:"有效"}),(l=N.value)==null||l.clearValidate()},Q=({rowIndex:l})=>l%2===1?"table-row-even":"";return le(()=>{B()}),(l,t)=>{const u=n("el-icon"),D=n("el-tag"),p=n("el-button"),y=n("el-input"),i=n("el-form-item"),h=n("el-option"),E=n("el-select"),M=n("el-form"),R=n("el-card"),m=n("el-table-column"),W=n("el-table"),S=n("el-input-number"),X=n("el-dialog"),Z=ae("loading");return x(),F("div",fe,[e(R,{class:"main-card",shadow:"hover"},{header:a(()=>[f("div",_e,[f("div",ge,[e(u,{class:"header-icon"},{default:a(()=>[e(c(ie))]),_:1}),t[10]||(t[10]=f("span",{class:"header-title"},"客戶管理",-1)),e(D,{type:"info",size:"small",class:"count-tag"},{default:a(()=>[d(" 共 "+C(V.value.length)+" 項 ",1)]),_:1})]),e(p,{type:"primary",onClick:G,class:"add-button"},{default:a(()=>[e(u,null,{default:a(()=>[e(c(de))]),_:1}),t[11]||(t[11]=d(" 新增客戶 ",-1))]),_:1})])]),default:a(()=>[e(R,{class:"search-card",shadow:"never"},{default:a(()=>[e(M,{inline:!0,model:o,class:"search-form"},{default:a(()=>[e(i,{label:"客戶名稱"},{default:a(()=>[e(y,{modelValue:o.customerName,"onUpdate:modelValue":t[0]||(t[0]=s=>o.customerName=s),placeholder:"請輸入客戶名稱",clearable:"",class:"search-input",onKeyup:T(L,["enter"])},{prefix:a(()=>[e(u,null,{default:a(()=>[e(c(U))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"稅號"},{default:a(()=>[e(y,{modelValue:o.taxId,"onUpdate:modelValue":t[1]||(t[1]=s=>o.taxId=s),placeholder:"請輸入稅號",clearable:"",class:"search-input",onKeyup:T(L,["enter"])},{prefix:a(()=>[e(u,null,{default:a(()=>[e(c(U))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"狀態"},{default:a(()=>[e(E,{modelValue:o.status,"onUpdate:modelValue":t[2]||(t[2]=s=>o.status=s),placeholder:"請選擇狀態",clearable:"",class:"search-select"},{default:a(()=>[e(h,{label:"有效",value:"有效"}),e(h,{label:"無效",value:"無效"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:a(()=>[e(p,{type:"primary",onClick:L,icon:c(U)},{default:a(()=>[...t[12]||(t[12]=[d(" 查詢 ",-1)])]),_:1},8,["icon"]),e(p,{onClick:O,icon:c(re)},{default:a(()=>[...t[13]||(t[13]=[d("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),se((x(),z(W,{data:K.value,stripe:"",class:"data-table",style:{width:"100%"},"default-sort":{prop:"id",order:"ascending"},"row-class-name":Q},{default:a(()=>[e(m,{prop:"id",label:"ID",width:"80",sortable:""}),e(m,{prop:"customerName",label:"客戶名稱","min-width":"180",sortable:""}),e(m,{prop:"taxId",label:"稅號",width:"150"}),e(m,{prop:"creditLimit",label:"信用額度",width:"120",align:"right"},{default:a(({row:s})=>[f("span",be,C(A(s.creditLimit)),1)]),_:1}),e(m,{prop:"currentBalance",label:"當前餘額",width:"120",align:"right"},{default:a(({row:s})=>[f("span",{class:oe(j(s.currentBalance))},C(A(s.currentBalance)),3)]),_:1}),e(m,{prop:"settlementCurrency",label:"結算貨幣",width:"120"},{default:a(({row:s})=>[s.settlementCurrency?(x(),z(D,{key:0,type:"info",size:"small"},{default:a(()=>[d(C(s.settlementCurrency),1)]),_:2},1024)):(x(),F("span",ve,"-"))]),_:1}),e(m,{prop:"status",label:"狀態",width:"100"},{default:a(({row:s})=>[e(D,{type:s.status==="有效"?"success":"danger"},{default:a(()=>[d(C(s.status),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"操作",width:"180",fixed:"right"},{default:a(({row:s})=>[e(p,{type:"primary",size:"small",icon:c(ne),onClick:ee=>H(s),class:"action-button"},{default:a(()=>[...t[14]||(t[14]=[d(" 編輯 ",-1)])]),_:1},8,["icon","onClick"]),e(p,{type:"danger",size:"small",icon:c(ue),onClick:ee=>Y(s),class:"action-button"},{default:a(()=>[...t[15]||(t[15]=[d(" 刪除 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[Z,v.value]])]),_:1}),e(X,{modelValue:g.value,"onUpdate:modelValue":t[9]||(t[9]=s=>g.value=s),title:I.value,width:"600px","close-on-click-modal":!1,class:"form-dialog"},{footer:a(()=>[f("div",ye,[e(p,{onClick:t[8]||(t[8]=s=>g.value=!1)},{default:a(()=>[...t[17]||(t[17]=[d("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:J,loading:k.value},{default:a(()=>[...t[18]||(t[18]=[d(" 確定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[e(M,{ref_key:"formRef",ref:N,model:r,rules:$,"label-width":"120px",class:"form-content"},{default:a(()=>[e(i,{label:"客戶名稱",prop:"customerName"},{default:a(()=>[e(y,{modelValue:r.customerName,"onUpdate:modelValue":t[3]||(t[3]=s=>r.customerName=s),placeholder:"請輸入客戶名稱",clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"稅號",prop:"taxId"},{default:a(()=>[e(y,{modelValue:r.taxId,"onUpdate:modelValue":t[4]||(t[4]=s=>r.taxId=s),placeholder:"請輸入稅號（可選）",clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"信用額度",prop:"creditLimit"},{default:a(()=>[e(S,{modelValue:r.creditLimit,"onUpdate:modelValue":t[5]||(t[5]=s=>r.creditLimit=s),min:0,precision:2,step:1e3,placeholder:"請輸入信用額度",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(i,{label:"結算貨幣",prop:"settlementCurrency"},{default:a(()=>[e(y,{modelValue:r.settlementCurrency,"onUpdate:modelValue":t[6]||(t[6]=s=>r.settlementCurrency=s),placeholder:"例如：CNY, USD",clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"狀態",prop:"status"},{default:a(()=>[e(E,{modelValue:r.status,"onUpdate:modelValue":t[7]||(t[7]=s=>r.status=s),placeholder:"請選擇狀態",style:{width:"100%"}},{default:a(()=>[e(h,{label:"有效",value:"有效"}),e(h,{label:"無效",value:"無效"})]),_:1},8,["modelValue"])]),_:1}),r.id?(x(),z(i,{key:0,label:"當前餘額"},{default:a(()=>[e(S,{"model-value":r.currentBalance,disabled:"",precision:2,style:{width:"100%"}},null,8,["model-value"]),t[16]||(t[16]=f("div",{class:"form-tip"},"當前餘額由系統自動計算，不可手動修改",-1))]),_:1})):me("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},he=pe(xe,[["__scopeId","data-v-d584e233"]]);export{he as default};
