import{a as g,r as U,o as $,b as r,c as d,d as i,e as n,f as l,g as c,w as t,u as z,i as A,z as y,H,F as w,C as I,t as m,E as B}from"./index-CAVot8kD.js";import{_ as L,a as O,f as W}from"./_plugin-vue_export-helper-CZBBfLPA.js";const G={class:"bank-reconciliation-management",style:{padding:"20px"}},J={class:"page-header"},K={class:"page-title"},Q={style:{display:"flex","justify-content":"space-between","align-items":"center"}},X={class:"number-text"},Y={class:"number-text success"},Z={key:0},ee={key:1,class:"text-muted"},te={key:0},le={key:1,class:"text-muted"},ne={__name:"BankReconciliationManagement",setup(ae){const v=g([]),b=g(!1),_=g(null),a=g(null),u=U({accountId:null,tolerance:.01}),C={accountId:[{required:!0,message:"请选择银行账户",trigger:"change"}],tolerance:[{required:!0,message:"请输入容差金额",trigger:"blur"},{type:"number",min:0,message:"容差金额必须大于等于 0",trigger:"blur"}]},M=async()=>{try{const o=await O.getAllAccounts();v.value=Array.isArray(o)?o.filter(e=>{var p;return((p=e.code)==null?void 0:p.startsWith("1"))||e.type==="ASSET"}):[]}catch(o){console.error("获取银行账户列表失败:",o),v.value=[]}},D=async()=>{if(_.value)try{await _.value.validate(),b.value=!0,a.value=null;const o={accountId:u.accountId,tolerance:u.tolerance},e=await W.autoReconcile(o);a.value=e,B.success("银行对账完成！")}catch(o){o!==!1&&(console.error("执行对账失败:",o),B.error(o.message||"执行对账失败，请检查后端服务是否启动"))}finally{b.value=!1}},E=()=>{var o;Object.assign(u,{accountId:null,tolerance:.01}),a.value=null,(o=_.value)==null||o.clearValidate()};return $(()=>{console.log("BankReconciliationManagement 组件已挂载"),M()}),(o,e)=>{const p=r("el-icon"),N=r("el-option"),j=r("el-select"),x=r("el-form-item"),S=r("el-col"),F=r("el-input-number"),q=r("el-row"),V=r("el-button"),P=r("el-form"),h=r("el-card"),k=r("el-tag"),f=r("el-descriptions-item"),T=r("el-descriptions"),R=r("el-alert");return i(),d("div",G,[n("div",J,[n("h1",K,[l(p,{class:"title-icon"},{default:t(()=>[l(z(A))]),_:1}),e[2]||(e[2]=c(" 银行对账 ",-1))]),e[3]||(e[3]=n("p",{class:"page-subtitle"},"自动匹配银行对账单与系统凭证，确保账目一致",-1))]),l(h,{class:"main-card",shadow:"hover"},{header:t(()=>[...e[4]||(e[4]=[n("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[n("span",{style:{"font-size":"18px","font-weight":"600"}},"自动银行对账")],-1)])]),default:t(()=>[l(h,{class:"form-card",shadow:"never",style:{"margin-bottom":"20px"}},{default:t(()=>[l(P,{ref_key:"formRef",ref:_,model:u,rules:C,"label-width":"140px"},{default:t(()=>[l(q,{gutter:20},{default:t(()=>[l(S,{span:12},{default:t(()=>[l(x,{label:"银行账户",prop:"accountId"},{default:t(()=>[l(j,{modelValue:u.accountId,"onUpdate:modelValue":e[0]||(e[0]=s=>u.accountId=s),placeholder:"请选择银行账户（资产科目）",filterable:"",style:{width:"100%"}},{default:t(()=>[(i(!0),d(w,null,I(v.value,s=>(i(),y(N,{key:s.id,label:`${s.code} - ${s.name}`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(S,{span:12},{default:t(()=>[l(x,{label:"容差金额",prop:"tolerance"},{default:t(()=>[l(F,{modelValue:u.tolerance,"onUpdate:modelValue":e[1]||(e[1]=s=>u.tolerance=s),min:0,precision:2,step:.01,style:{width:"100%"}},null,8,["modelValue"]),e[5]||(e[5]=n("div",{style:{"margin-top":"5px",color:"#909399","font-size":"12px"}}," 允许的金额差异范围（默认：0.01） ",-1))]),_:1})]),_:1})]),_:1}),l(x,null,{default:t(()=>[l(V,{type:"primary",onClick:D,loading:b.value,size:"large"},{default:t(()=>[l(p,null,{default:t(()=>[l(z(A))]),_:1}),e[6]||(e[6]=c(" 执行自动对账 ",-1))]),_:1},8,["loading"]),l(V,{onClick:E},{default:t(()=>[...e[7]||(e[7]=[c("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a.value?(i(),y(h,{key:0,class:"result-card",shadow:"never"},{header:t(()=>[n("div",Q,[e[9]||(e[9]=n("span",{style:{"font-size":"16px","font-weight":"600"}},"对账结果",-1)),l(k,{type:"success",size:"large"},{default:t(()=>[...e[8]||(e[8]=[c("对账完成",-1)])]),_:1})])]),default:t(()=>[l(T,{column:2,border:""},{default:t(()=>[l(f,{label:"处理的对账单数量"},{default:t(()=>[n("span",X,m(a.value.totalStatementsProcessed),1)]),_:1}),l(f,{label:"成功匹配数量"},{default:t(()=>[n("span",Y,m(a.value.matchedCount),1)]),_:1}),l(f,{label:"匹配的对账单ID",span:2},{default:t(()=>[a.value.matchedStatementIds&&a.value.matchedStatementIds.length>0?(i(),d("div",Z,[(i(!0),d(w,null,I(a.value.matchedStatementIds,s=>(i(),y(k,{key:s,type:"success",size:"small",style:{"margin-right":"8px","margin-bottom":"4px"}},{default:t(()=>[c(" #"+m(s),1)]),_:2},1024))),128))])):(i(),d("span",ee,"无"))]),_:1}),l(f,{label:"匹配的凭证分录ID",span:2},{default:t(()=>[a.value.matchedSplitIds&&a.value.matchedSplitIds.length>0?(i(),d("div",te,[(i(!0),d(w,null,I(a.value.matchedSplitIds,s=>(i(),y(k,{key:s,type:"info",size:"small",style:{"margin-right":"8px","margin-bottom":"4px"}},{default:t(()=>[c(" #"+m(s),1)]),_:2},1024))),128))])):(i(),d("span",le,"无"))]),_:1})]),_:1}),l(R,{type:"success",closable:!1,style:{"margin-top":"15px"}},{title:t(()=>[n("div",null,[e[10]||(e[10]=n("strong",null,"对账完成！",-1)),e[11]||(e[11]=n("br",null,null,-1)),c(" 共处理 "+m(a.value.totalStatementsProcessed)+" 条对账单， 成功匹配 "+m(a.value.matchedCount)+" 条记录。 ",1)])]),_:1})]),_:1})):H("",!0),l(R,{type:"info",closable:!1,style:{"margin-top":"20px"}},{title:t(()=>[...e[12]||(e[12]=[n("div",{style:{"font-size":"14px","line-height":"1.6"}},[n("strong",null,"使用说明："),n("br"),c(" 1. 选择需要进行对账的银行账户（资产类科目）"),n("br"),c(" 2. 设置容差金额，系统会自动匹配金额差异在容差范围内的记录"),n("br"),c(" 3. 点击「执行自动对账」按钮，系统会自动匹配银行对账单与系统凭证"),n("br"),c(" 4. 查看对账结果，了解匹配情况 ")],-1)])]),_:1})]),_:1})])}}},re=L(ne,[["__scopeId","data-v-59e7bec2"]]);export{re as default};
