import{a as r,o as W,b as n,p as X,c as V,d as m,e as g,f as l,g as d,w as s,u as z,j as Y,q as Z,z as U,H as ee,F as M,C as N,t as C,B as le,E as i,D as ae}from"./index-CAVot8kD.js";import{_ as se,u as c}from"./_plugin-vue_export-helper-CZBBfLPA.js";const te={class:"user-management",style:{padding:"20px"}},oe={class:"page-header"},ne={class:"page-title"},re={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ue={key:0,style:{color:"#909399"}},de={__name:"UserManagement",setup(ie){const B=r([]),F=r([]),h=r(!1),p=r(!1),u=r(!1),k=r(!1),v=r(null),x=r(null),t=r({username:"",password:"",enabled:!0,roleIds:[]}),$={username:[{required:!0,message:"請輸入使用者名稱",trigger:"blur"},{min:3,max:50,message:"使用者名稱長度應在 3 到 50 個字符之間",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{min:6,message:"密碼長度至少 6 個字符",trigger:"blur"}]},I=async()=>{h.value=!0;try{const o=await c.getAllUsers();B.value=o}catch(o){i.error("載入使用者列表失敗："+o.message)}finally{h.value=!1}},q=async()=>{try{const o=await c.getAllRoles();F.value=o}catch(o){i.error("載入角色列表失敗："+o.message)}},A=()=>{u.value=!1,x.value=null,D(),p.value=!0},T=async o=>{u.value=!0,x.value=o.id;try{const e=await c.getUserById(o.id);t.value={username:e.username,password:"",enabled:e.enabled,roleIds:e.roles?e.roles.map(b=>b.id):[]},p.value=!0}catch(e){i.error("載入使用者資訊失敗："+e.message)}},j=async o=>{try{await ae.confirm(`確定要刪除使用者「${o.username}」嗎？此操作無法撤銷。`,"確認刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}),await c.deleteUser(o.id),i.success("使用者刪除成功"),I()}catch(e){e!=="cancel"&&i.error("刪除使用者失敗："+e.message)}},H=async()=>{v.value&&await v.value.validate(async o=>{if(o){k.value=!0;try{if(u.value){const e={username:t.value.username,enabled:t.value.enabled,roleIds:t.value.roleIds||[]};t.value.password&&t.value.password.trim()!==""&&(e.password=t.value.password),await c.updateUser(x.value,e),i.success("使用者更新成功")}else await c.createUser({username:t.value.username,password:t.value.password,enabled:t.value.enabled,roleIds:t.value.roleIds||[]}),i.success("使用者創建成功");p.value=!1,I()}catch(e){i.error((u.value?"更新":"創建")+"使用者失敗："+e.message)}finally{k.value=!1}}})},D=()=>{t.value={username:"",password:"",enabled:!0,roleIds:[]},v.value&&v.value.clearValidate()};return W(()=>{I(),q()}),(o,e)=>{const b=n("el-icon"),f=n("el-button"),_=n("el-table-column"),E=n("el-tag"),L=n("el-table"),S=n("el-card"),R=n("el-input"),y=n("el-form-item"),G=n("el-switch"),J=n("el-option"),K=n("el-select"),O=n("el-form"),P=n("el-dialog"),Q=X("loading");return m(),V("div",te,[g("div",oe,[g("h1",ne,[l(b,{class:"title-icon"},{default:s(()=>[l(z(Y))]),_:1}),e[6]||(e[6]=d(" 使用者管理 ",-1))]),e[7]||(e[7]=g("p",{class:"page-subtitle"},"新增、修改、管理系統使用者和其角色",-1))]),l(S,{class:"main-card",shadow:"hover"},{header:s(()=>[g("div",re,[e[9]||(e[9]=g("span",{style:{"font-size":"18px","font-weight":"600"}},"使用者列表",-1)),l(f,{type:"primary",onClick:A},{default:s(()=>[l(b,null,{default:s(()=>[l(z(le))]),_:1}),e[8]||(e[8]=d(" 新增使用者 ",-1))]),_:1})])]),default:s(()=>[Z((m(),U(L,{data:B.value,stripe:"",style:{width:"100%"}},{default:s(()=>[l(_,{prop:"id",label:"ID",width:"80"}),l(_,{prop:"username",label:"使用者名稱","min-width":"150"}),l(_,{label:"角色","min-width":"200"},{default:s(({row:a})=>[(m(!0),V(M,null,N(a.roles,w=>(m(),U(E,{key:w.id,type:"info",size:"small",style:{"margin-right":"6px"}},{default:s(()=>[d(C(w.name),1)]),_:2},1024))),128)),!a.roles||a.roles.length===0?(m(),V("span",ue,"無角色")):ee("",!0)]),_:1}),l(_,{prop:"enabled",label:"狀態",width:"100"},{default:s(({row:a})=>[l(E,{type:a.enabled?"success":"danger"},{default:s(()=>[d(C(a.enabled?"啟用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(_,{label:"操作",width:"200"},{default:s(({row:a})=>[l(f,{type:"primary",link:"",size:"small",onClick:w=>T(a)},{default:s(()=>[...e[10]||(e[10]=[d("編輯",-1)])]),_:1},8,["onClick"]),l(f,{type:"danger",link:"",size:"small",onClick:w=>j(a)},{default:s(()=>[...e[11]||(e[11]=[d("刪除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,h.value]])]),_:1}),l(P,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a),title:u.value?"編輯使用者":"新增使用者",width:"500px",onClose:D},{footer:s(()=>[l(f,{onClick:e[4]||(e[4]=a=>p.value=!1)},{default:s(()=>[...e[12]||(e[12]=[d("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:H,loading:k.value},{default:s(()=>[d(C(u.value?"更新":"創建"),1)]),_:1},8,["loading"])]),default:s(()=>[l(O,{ref_key:"userFormRef",ref:v,model:t.value,rules:$,"label-width":"100px"},{default:s(()=>[l(y,{label:"使用者名稱",prop:"username"},{default:s(()=>[l(R,{modelValue:t.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.username=a),placeholder:"請輸入使用者名稱"},null,8,["modelValue"])]),_:1}),l(y,{label:"密碼",prop:u.value?"":"password"},{default:s(()=>[l(R,{modelValue:t.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.password=a),type:"password",placeholder:u.value?"留空則不修改密碼":"請輸入密碼","show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["prop"]),l(y,{label:"狀態",prop:"enabled"},{default:s(()=>[l(G,{modelValue:t.value.enabled,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.enabled=a)},null,8,["modelValue"])]),_:1}),l(y,{label:"角色",prop:"roleIds"},{default:s(()=>[l(K,{modelValue:t.value.roleIds,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.roleIds=a),multiple:"",placeholder:"請選擇角色",style:{width:"100%"}},{default:s(()=>[(m(!0),V(M,null,N(F.value,a=>(m(),U(J,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ce=se(de,[["__scopeId","data-v-4e2ce26d"]]);export{ce as default};
