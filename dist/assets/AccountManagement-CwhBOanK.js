import{a as m,r as O,n as R,o as ie,b as r,p as de,c as q,d as D,f as e,w as a,q as ue,v as z,u as f,x as S,g as i,y as ce,z as F,t as w,l as pe,A as me,e as U,i as fe,B as ve,F as _e,C as be,E as _,D as ge}from"./index-CAVot8kD.js";import{_ as ye,a as T}from"./_plugin-vue_export-helper-CZBBfLPA.js";const Ve={class:"account-management"},Ee={class:"card-header"},Ie={class:"header-left"},Ae={__name:"AccountManagement",setup(De){const x=m(!1),g=m([]),b=m(!1),C=m("新增科目"),M=m(!1),E=m(null),y=m(!1),I=m(null),s=O({code:"",name:"",type:""}),o=O({code:"",name:"",type:"",parentId:null,balanceDirection:"DEBIT",auxiliaryManagement:"",isActive:!0}),P={code:[{required:!0,message:"請輸入科目代碼",trigger:"blur"},{pattern:/^[0-9]{4}$/,message:"科目代碼必須為4位數字",trigger:"blur"}],name:[{required:!0,message:"請輸入科目名稱",trigger:"blur"}],type:[{required:!0,message:"請選擇科目類型",trigger:"change"}],balanceDirection:[{required:!0,message:"請選擇餘額方向",trigger:"change"}]},Q=R(()=>{let t=g.value;return s.code&&(t=t.filter(l=>{var c;return(c=l.code)==null?void 0:c.toLowerCase().includes(s.code.toLowerCase())})),s.name&&(t=t.filter(l=>{var c;return(c=l.name)==null?void 0:c.toLowerCase().includes(s.name.toLowerCase())})),s.type&&(t=t.filter(l=>l.type===s.type)),t}),X=R(()=>g.value.filter(t=>y.value&&t.id===I.value?!1:t.isActive)),h=async()=>{x.value=!0;try{const t=await T.getAllAccounts();g.value=Array.isArray(t)?t:[],_.success(`成功載入 ${g.value.length} 條科目記錄`)}catch(t){_.error("載入科目列表失敗："+(t.message||"未知錯誤"))}finally{x.value=!1}},B=()=>{},K=()=>{s.code="",s.name="",s.type=""},j=()=>{y.value=!1,I.value=null,C.value="新增科目",L(),b.value=!0},G=t=>{y.value=!0,I.value=t.id,C.value="編輯科目",Object.assign(o,{code:t.code,name:t.name,type:t.type,parentId:t.parentId,balanceDirection:t.balanceDirection,auxiliaryManagement:t.auxiliaryManagement||"",isActive:t.isActive}),b.value=!0},H=async t=>{try{await ge.confirm(`確定要刪除科目「${t.code} - ${t.name}」嗎？`,"確認刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}),await T.deleteAccount(t.id),_.success("刪除成功"),h()}catch(l){l!=="cancel"&&_.error("刪除失敗："+(l.message||"未知錯誤"))}},J=async()=>{if(E.value)try{await E.value.validate(),M.value=!0;const t={code:o.code,name:o.name,type:o.type,parentId:o.parentId||null,balanceDirection:o.balanceDirection,auxiliaryManagement:o.auxiliaryManagement||null,isActive:o.isActive};y.value?(await T.updateAccount(I.value,t),_.success("更新成功")):(await T.createAccount(t),_.success("新增成功")),b.value=!1,h()}catch(t){t!==!1&&_.error((y.value?"更新":"新增")+"失敗："+(t.message||"未知錯誤"))}finally{M.value=!1}},W=()=>{var t;L(),(t=E.value)==null||t.clearValidate()},L=()=>{Object.assign(o,{code:"",name:"",type:"",parentId:null,balanceDirection:"DEBIT",auxiliaryManagement:"",isActive:!0})},Z=t=>({ASSET:"資產",LIABILITY:"負債",EQUITY:"權益",INCOME:"收入",EXPENSE:"支出"})[t]||t,ee=t=>({ASSET:"success",LIABILITY:"warning",EQUITY:"info",INCOME:"",EXPENSE:"danger"})[t]||"",le=({row:t,rowIndex:l})=>l%2===1?"table-row-light":"";return ie(()=>{h()}),(t,l)=>{const c=r("el-icon"),A=r("el-tag"),v=r("el-button"),V=r("el-input"),d=r("el-form-item"),u=r("el-option"),k=r("el-select"),N=r("el-form"),$=r("el-card"),p=r("el-table-column"),ae=r("el-table"),Y=r("el-radio"),te=r("el-radio-group"),ne=r("el-switch"),oe=r("el-dialog"),se=de("loading");return D(),q("div",Ve,[e($,{class:"main-card",shadow:"hover"},{header:a(()=>[U("div",Ee,[U("div",Ie,[e(c,{class:"header-icon"},{default:a(()=>[e(f(fe))]),_:1}),l[12]||(l[12]=U("span",{class:"header-title"},"科目管理",-1)),e(A,{type:"info",size:"small",class:"count-tag"},{default:a(()=>[i(" 共 "+w(g.value.length)+" 項 ",1)]),_:1})]),e(v,{type:"primary",onClick:j,class:"add-button"},{default:a(()=>[e(c,null,{default:a(()=>[e(f(ve))]),_:1}),l[13]||(l[13]=i(" 新增科目 ",-1))]),_:1})])]),default:a(()=>[e($,{class:"search-card",shadow:"never"},{default:a(()=>[e(N,{inline:!0,model:s,class:"search-form"},{default:a(()=>[e(d,{label:"科目代碼"},{default:a(()=>[e(V,{modelValue:s.code,"onUpdate:modelValue":l[0]||(l[0]=n=>s.code=n),placeholder:"請輸入科目代碼",clearable:"",class:"search-input",onKeyup:z(B,["enter"])},{prefix:a(()=>[e(c,null,{default:a(()=>[e(f(S))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"科目名稱"},{default:a(()=>[e(V,{modelValue:s.name,"onUpdate:modelValue":l[1]||(l[1]=n=>s.name=n),placeholder:"請輸入科目名稱",clearable:"",class:"search-input",onKeyup:z(B,["enter"])},{prefix:a(()=>[e(c,null,{default:a(()=>[e(f(S))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"科目類型"},{default:a(()=>[e(k,{modelValue:s.type,"onUpdate:modelValue":l[2]||(l[2]=n=>s.type=n),placeholder:"請選擇類型",clearable:"",class:"search-select"},{default:a(()=>[e(u,{label:"資產",value:"ASSET"}),e(u,{label:"負債",value:"LIABILITY"}),e(u,{label:"權益",value:"EQUITY"}),e(u,{label:"收入",value:"INCOME"}),e(u,{label:"支出",value:"EXPENSE"})]),_:1},8,["modelValue"])]),_:1}),e(d,null,{default:a(()=>[e(v,{type:"primary",onClick:B,icon:f(S)},{default:a(()=>[...l[14]||(l[14]=[i(" 查詢 ",-1)])]),_:1},8,["icon"]),e(v,{onClick:K,icon:f(ce)},{default:a(()=>[...l[15]||(l[15]=[i("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),ue((D(),F(ae,{data:Q.value,stripe:"",class:"data-table",style:{width:"100%"},"default-sort":{prop:"code",order:"ascending"},"row-class-name":le},{default:a(()=>[e(p,{prop:"code",label:"科目代碼",width:"120",sortable:""}),e(p,{prop:"name",label:"科目名稱","min-width":"150"}),e(p,{prop:"type",label:"科目類型",width:"100"},{default:a(({row:n})=>[e(A,{type:ee(n.type)},{default:a(()=>[i(w(Z(n.type)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"parentCode",label:"父科目代碼",width:"120"}),e(p,{prop:"parentName",label:"父科目名稱","min-width":"150"}),e(p,{prop:"balanceDirection",label:"餘額方向",width:"100"},{default:a(({row:n})=>[e(A,{type:n.balanceDirection==="DEBIT"?"success":"warning"},{default:a(()=>[i(w(n.balanceDirection==="DEBIT"?"借方":"貸方"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"auxiliaryManagement",label:"輔助核算",width:"120"}),e(p,{prop:"isActive",label:"狀態",width:"80"},{default:a(({row:n})=>[e(A,{type:n.isActive?"success":"danger"},{default:a(()=>[i(w(n.isActive?"啟用":"停用"),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作",width:"200",fixed:"right",align:"center"},{default:a(({row:n})=>[e(v,{type:"primary",link:"",size:"small",onClick:re=>G(n),icon:f(pe)},{default:a(()=>[...l[16]||(l[16]=[i(" 編輯 ",-1)])]),_:1},8,["onClick","icon"]),e(v,{type:"danger",link:"",size:"small",onClick:re=>H(n),icon:f(me)},{default:a(()=>[...l[17]||(l[17]=[i(" 刪除 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[se,x.value]])]),_:1}),e(oe,{modelValue:b.value,"onUpdate:modelValue":l[11]||(l[11]=n=>b.value=n),title:C.value,width:"650px",class:"form-dialog",onClose:W},{footer:a(()=>[e(v,{onClick:l[10]||(l[10]=n=>b.value=!1)},{default:a(()=>[...l[20]||(l[20]=[i("取消",-1)])]),_:1}),e(v,{type:"primary",onClick:J,loading:M.value},{default:a(()=>[...l[21]||(l[21]=[i(" 確定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(N,{ref_key:"formRef",ref:E,model:o,rules:P,"label-width":"120px"},{default:a(()=>[e(d,{label:"科目代碼",prop:"code"},{default:a(()=>[e(V,{modelValue:o.code,"onUpdate:modelValue":l[3]||(l[3]=n=>o.code=n),placeholder:"請輸入科目代碼"},null,8,["modelValue"])]),_:1}),e(d,{label:"科目名稱",prop:"name"},{default:a(()=>[e(V,{modelValue:o.name,"onUpdate:modelValue":l[4]||(l[4]=n=>o.name=n),placeholder:"請輸入科目名稱"},null,8,["modelValue"])]),_:1}),e(d,{label:"科目類型",prop:"type"},{default:a(()=>[e(k,{modelValue:o.type,"onUpdate:modelValue":l[5]||(l[5]=n=>o.type=n),placeholder:"請選擇科目類型",style:{width:"100%"}},{default:a(()=>[e(u,{label:"資產",value:"ASSET"}),e(u,{label:"負債",value:"LIABILITY"}),e(u,{label:"權益",value:"EQUITY"}),e(u,{label:"收入",value:"INCOME"}),e(u,{label:"支出",value:"EXPENSE"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"父科目"},{default:a(()=>[e(k,{modelValue:o.parentId,"onUpdate:modelValue":l[6]||(l[6]=n=>o.parentId=n),placeholder:"請選擇父科目（可選）",clearable:"",filterable:"",style:{width:"100%"}},{default:a(()=>[(D(!0),q(_e,null,be(X.value,n=>(D(),F(u,{key:n.id,label:`${n.code} - ${n.name}`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"餘額方向",prop:"balanceDirection"},{default:a(()=>[e(te,{modelValue:o.balanceDirection,"onUpdate:modelValue":l[7]||(l[7]=n=>o.balanceDirection=n)},{default:a(()=>[e(Y,{label:"DEBIT"},{default:a(()=>[...l[18]||(l[18]=[i("借方",-1)])]),_:1}),e(Y,{label:"CREDIT"},{default:a(()=>[...l[19]||(l[19]=[i("貸方",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"輔助核算"},{default:a(()=>[e(V,{modelValue:o.auxiliaryManagement,"onUpdate:modelValue":l[8]||(l[8]=n=>o.auxiliaryManagement=n),placeholder:"請輸入輔助核算（可選）"},null,8,["modelValue"])]),_:1}),e(d,{label:"狀態"},{default:a(()=>[e(ne,{modelValue:o.isActive,"onUpdate:modelValue":l[9]||(l[9]=n=>o.isActive=n),"active-text":"啟用","inactive-text":"停用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},xe=ye(Ae,[["__scopeId","data-v-1a4d4306"]]);export{xe as default};
