import{a as y,r as $,o as H,b as r,c as b,d as c,e as u,f as e,g as i,w as l,u as F,i as P,z as w,H as q,F as O,C as W,t as d,E as x}from"./index-CAVot8kD.js";import{_ as G,a as J,e as K}from"./_plugin-vue_export-helper-CZBBfLPA.js";const X={class:"tax-management",style:{padding:"20px"}},Z={class:"page-header"},ee={class:"page-title"},te={style:{display:"flex","justify-content":"space-between","align-items":"center"}},le={class:"amount-text large"},ae={key:0},ne={key:1},oe={__name:"TaxManagement",setup(se){const v=y([]),D=y(!1),g=y(null),o=y(null),n=$({filingPeriod:"",taxType:"企业所得税",startDate:"",endDate:"",taxRate:.25,bankAccountId:null}),S={filingPeriod:[{required:!0,message:"请输入申报期间",trigger:"blur"}],taxType:[{required:!0,message:"请输入税种",trigger:"blur"}],startDate:[{required:!0,message:"请选择开始日期",trigger:"change"}],endDate:[{required:!0,message:"请选择结束日期",trigger:"change"}],taxRate:[{required:!0,message:"请输入税率",trigger:"blur"},{type:"number",min:0,max:1,message:"税率必须在 0 到 1 之间",trigger:"blur"}],bankAccountId:[{required:!0,message:"请选择银行账户",trigger:"change"}]},h=a=>a==null?"0.00":Number(a).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),I=a=>({DRAFT:"info",FILED:"success",PAID:"success",FAILED:"danger"})[a]||"",Y=a=>({DRAFT:"草稿",FILED:"已申报",PAID:"已缴纳",FAILED:"申报失败"})[a]||a,z=async()=>{try{const a=await J.getAllAccounts();v.value=Array.isArray(a)?a.filter(t=>{var _;return((_=t.code)==null?void 0:_.startsWith("1"))||t.type==="ASSET"}):[]}catch(a){console.error("获取银行账户列表失败:",a),v.value=[]}},C=async()=>{if(g.value)try{await g.value.validate(),D.value=!0,o.value=null;const a={filingPeriod:n.filingPeriod,taxType:n.taxType,startDate:n.startDate,endDate:n.endDate,taxRate:n.taxRate,bankAccountId:n.bankAccountId},t=await K.calculateAndFile(a);t?(o.value=t,x.success("税务计算和申报成功！")):x.info("本期无需缴纳税款，未创建申报记录")}catch(a){a!==!1&&(console.error("计算并申报税务失败:",a),a.status===204?x.info("本期无需缴纳税款"):x.error(a.message||"计算并申报税务失败"))}finally{D.value=!1}},E=()=>{var a;Object.assign(n,{filingPeriod:"",taxType:"企业所得税",startDate:"",endDate:"",taxRate:.25,bankAccountId:null}),o.value=null,(a=g.value)==null||a.clearValidate()};return H(()=>{console.log("TaxManagement 组件已挂载"),z()}),(a,t)=>{const _=r("el-icon"),R=r("el-input"),p=r("el-form-item"),m=r("el-col"),A=r("el-row"),T=r("el-date-picker"),N=r("el-input-number"),L=r("el-option"),U=r("el-select"),M=r("el-button"),B=r("el-form"),k=r("el-card"),V=r("el-tag"),f=r("el-descriptions-item"),j=r("el-descriptions"),Q=r("el-alert");return c(),b("div",X,[u("div",Z,[u("h1",ee,[e(_,{class:"title-icon"},{default:l(()=>[e(F(P))]),_:1}),t[6]||(t[6]=i(" 税务管理 ",-1))]),t[7]||(t[7]=u("p",{class:"page-subtitle"},"计算和申报税务，自动生成税务申报记录和付款申请",-1))]),e(k,{class:"main-card",shadow:"hover"},{header:l(()=>[...t[8]||(t[8]=[u("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[u("span",{style:{"font-size":"18px","font-weight":"600"}},"税务计算与申报")],-1)])]),default:l(()=>[e(k,{class:"form-card",shadow:"never",style:{"margin-bottom":"20px"}},{default:l(()=>[e(B,{ref_key:"formRef",ref:g,model:n,rules:S,"label-width":"140px"},{default:l(()=>[e(A,{gutter:20},{default:l(()=>[e(m,{span:12},{default:l(()=>[e(p,{label:"申报期间",prop:"filingPeriod"},{default:l(()=>[e(R,{modelValue:n.filingPeriod,"onUpdate:modelValue":t[0]||(t[0]=s=>n.filingPeriod=s),placeholder:"例如：2025-Q4",style:{width:"100%"}},null,8,["modelValue"]),t[9]||(t[9]=u("div",{style:{"margin-top":"5px",color:"#909399","font-size":"12px"}}," 格式：YYYY-QN（如：2025-Q4） ",-1))]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"税种",prop:"taxType"},{default:l(()=>[e(R,{modelValue:n.taxType,"onUpdate:modelValue":t[1]||(t[1]=s=>n.taxType=s),placeholder:"例如：企业所得税",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A,{gutter:20},{default:l(()=>[e(m,{span:12},{default:l(()=>[e(p,{label:"开始日期",prop:"startDate"},{default:l(()=>[e(T,{modelValue:n.startDate,"onUpdate:modelValue":t[2]||(t[2]=s=>n.startDate=s),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"结束日期",prop:"endDate"},{default:l(()=>[e(T,{modelValue:n.endDate,"onUpdate:modelValue":t[3]||(t[3]=s=>n.endDate=s),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A,{gutter:20},{default:l(()=>[e(m,{span:12},{default:l(()=>[e(p,{label:"税率",prop:"taxRate"},{default:l(()=>[e(N,{modelValue:n.taxRate,"onUpdate:modelValue":t[4]||(t[4]=s=>n.taxRate=s),min:0,max:1,precision:4,step:.01,style:{width:"100%"}},null,8,["modelValue"]),t[10]||(t[10]=u("div",{style:{"margin-top":"5px",color:"#909399","font-size":"12px"}}," 例如：0.25 表示 25% ",-1))]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"银行账户",prop:"bankAccountId"},{default:l(()=>[e(U,{modelValue:n.bankAccountId,"onUpdate:modelValue":t[5]||(t[5]=s=>n.bankAccountId=s),placeholder:"请选择用于支付税款的银行账户",filterable:"",style:{width:"100%"}},{default:l(()=>[(c(!0),b(O,null,W(v.value,s=>(c(),w(L,{key:s.id,label:`${s.code} - ${s.name}`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(M,{type:"primary",onClick:C,loading:D.value,size:"large"},{default:l(()=>[e(_,null,{default:l(()=>[e(F(P))]),_:1}),t[11]||(t[11]=i(" 计算并申报税务 ",-1))]),_:1},8,["loading"]),e(M,{onClick:E},{default:l(()=>[...t[12]||(t[12]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o.value?(c(),w(k,{key:0,class:"result-card",shadow:"never"},{header:l(()=>[u("div",te,[t[13]||(t[13]=u("span",{style:{"font-size":"16px","font-weight":"600"}},"申报结果",-1)),e(V,{type:I(o.value.filingStatus),size:"large"},{default:l(()=>[i(d(Y(o.value.filingStatus)),1)]),_:1},8,["type"])])]),default:l(()=>[e(j,{column:2,border:""},{default:l(()=>[e(f,{label:"申报ID"},{default:l(()=>[i(d(o.value.id),1)]),_:1}),e(f,{label:"申报期间"},{default:l(()=>[i(d(o.value.filingPeriod),1)]),_:1}),e(f,{label:"税种"},{default:l(()=>[i(d(o.value.taxType),1)]),_:1}),e(f,{label:"应缴税额"},{default:l(()=>[u("span",le,d(h(o.value.payableAmount)),1)]),_:1}),e(f,{label:"申报状态"},{default:l(()=>[e(V,{type:I(o.value.filingStatus)},{default:l(()=>[i(d(Y(o.value.filingStatus)),1)]),_:1},8,["type"])]),_:1}),o.value.paymentRequestId?(c(),w(f,{key:0,label:"付款申请ID"},{default:l(()=>[e(V,{type:"success"},{default:l(()=>[i("#"+d(o.value.paymentRequestId),1)]),_:1})]),_:1})):q("",!0)]),_:1}),e(Q,{type:"success",closable:!1,style:{"margin-top":"15px"}},{title:l(()=>[u("div",null,[t[14]||(t[14]=u("strong",null,"申报成功！",-1)),t[15]||(t[15]=u("br",null,null,-1)),o.value.paymentRequestId?(c(),b("span",ae," 已自动创建付款申请 #"+d(o.value.paymentRequestId)+"，请在「付款管理」中执行付款。 ",1)):(c(),b("span",ne," 本期无需缴纳税款。 "))])]),_:1})]),_:1})):q("",!0)]),_:1})])}}},ie=G(oe,[["__scopeId","data-v-c308f1c1"]]);export{ie as default};
