import{a as _,r as M,n as X,o as Z,b as r,p as ee,c as R,d as N,f as e,w as a,q as te,v as q,u as m,x as U,g as c,y as ae,z as L,t as D,l as le,A as oe,e as C,j as se,B as ne,E as v,D as re}from"./index-CAVot8kD.js";import{_ as de,v as k}from"./_plugin-vue_export-helper-CZBBfLPA.js";const ue={class:"vendor-management"},ce={class:"card-header"},ie={class:"header-left"},me={key:1,class:"text-muted"},pe={class:"dialog-footer"},fe={__name:"VendorManagement",setup(ve){const y=_([]),g=_(!1),b=_(!1),w=_("新增供應商"),h=_(!1),V=_(null),n=M({vendorName:"",taxId:"",status:""}),s=M({id:null,vendorName:"",taxId:"",contactPerson:"",bankAcctNo:"",settlementCurrency:"",status:"有效"}),S={vendorName:[{required:!0,message:"請輸入供應商名稱",trigger:"blur"},{min:2,max:150,message:"長度在 2 到 150 個字符",trigger:"blur"}],taxId:[{required:!0,message:"請輸入稅號",trigger:"blur"},{min:1,max:50,message:"長度在 1 到 50 個字符",trigger:"blur"}],contactPerson:[{max:100,message:"長度不能超過 100 個字符",trigger:"blur"}],bankAcctNo:[{max:50,message:"長度不能超過 50 個字符",trigger:"blur"}],settlementCurrency:[{max:10,message:"長度不能超過 10 個字符",trigger:"blur"}],status:[{required:!0,message:"請選擇狀態",trigger:"change"}]},T=X(()=>{let l=y.value;return n.vendorName&&(l=l.filter(t=>{var d;return(d=t.vendorName)==null?void 0:d.toLowerCase().includes(n.vendorName.toLowerCase())})),n.taxId&&(l=l.filter(t=>{var d;return(d=t.taxId)==null?void 0:d.toLowerCase().includes(n.taxId.toLowerCase())})),n.status&&(l=l.filter(t=>t.status===n.status)),l}),I=async()=>{g.value=!0;try{const l=await k.getAllVendors();y.value=Array.isArray(l)?l:[],v.success("供應商列表加載成功")}catch(l){console.error("獲取供應商列表失敗:",l),v.error(l.message||"獲取供應商列表失敗"),y.value=[]}finally{g.value=!1}},A=()=>{},$=()=>{n.vendorName="",n.taxId="",n.status=""},j=()=>{w.value="新增供應商",Y(),b.value=!0},K=l=>{w.value="編輯供應商",Object.assign(s,{id:l.id,vendorName:l.vendorName||"",taxId:l.taxId||"",contactPerson:l.contactPerson||"",bankAcctNo:l.bankAcctNo||"",settlementCurrency:l.settlementCurrency||"",status:l.status||"有效"}),b.value=!0},F=async l=>{try{await re.confirm(`確定要刪除供應商「${l.vendorName}」嗎？此操作不可恢復。`,"確認刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}),g.value=!0,await k.deleteVendor(l.id),v.success("刪除成功"),await I()}catch(t){t!=="cancel"&&(console.error("刪除供應商失敗:",t),v.error(t.message||"刪除供應商失敗"))}finally{g.value=!1}},O=async()=>{if(V.value)try{await V.value.validate(),h.value=!0;const l={vendorName:s.vendorName,taxId:s.taxId,contactPerson:s.contactPerson||null,bankAcctNo:s.bankAcctNo||null,settlementCurrency:s.settlementCurrency||null,status:s.status};s.id?(await k.updateVendor(s.id,l),v.success("更新成功")):(await k.createVendor(l),v.success("新增成功")),b.value=!1,await I()}catch(l){l!==!1&&(console.error("提交失敗:",l),v.error(l.message||"提交失敗"))}finally{h.value=!1}},Y=()=>{var l;Object.assign(s,{id:null,vendorName:"",taxId:"",contactPerson:"",bankAcctNo:"",settlementCurrency:"",status:"有效"}),(l=V.value)==null||l.clearValidate()},G=({rowIndex:l})=>l%2===1?"table-row-even":"";return Z(()=>{I()}),(l,t)=>{const d=r("el-icon"),P=r("el-tag"),p=r("el-button"),f=r("el-input"),u=r("el-form-item"),x=r("el-option"),B=r("el-select"),z=r("el-form"),E=r("el-card"),i=r("el-table-column"),H=r("el-table"),J=r("el-dialog"),Q=ee("loading");return N(),R("div",ue,[e(E,{class:"main-card",shadow:"hover"},{header:a(()=>[C("div",ce,[C("div",ie,[e(d,{class:"header-icon"},{default:a(()=>[e(m(se))]),_:1}),t[11]||(t[11]=C("span",{class:"header-title"},"供應商管理",-1)),e(P,{type:"info",size:"small",class:"count-tag"},{default:a(()=>[c(" 共 "+D(y.value.length)+" 項 ",1)]),_:1})]),e(p,{type:"primary",onClick:j,class:"add-button"},{default:a(()=>[e(d,null,{default:a(()=>[e(m(ne))]),_:1}),t[12]||(t[12]=c(" 新增供應商 ",-1))]),_:1})])]),default:a(()=>[e(E,{class:"search-card",shadow:"never"},{default:a(()=>[e(z,{inline:!0,model:n,class:"search-form"},{default:a(()=>[e(u,{label:"供應商名稱"},{default:a(()=>[e(f,{modelValue:n.vendorName,"onUpdate:modelValue":t[0]||(t[0]=o=>n.vendorName=o),placeholder:"請輸入供應商名稱",clearable:"",class:"search-input",onKeyup:q(A,["enter"])},{prefix:a(()=>[e(d,null,{default:a(()=>[e(m(U))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"稅號"},{default:a(()=>[e(f,{modelValue:n.taxId,"onUpdate:modelValue":t[1]||(t[1]=o=>n.taxId=o),placeholder:"請輸入稅號",clearable:"",class:"search-input",onKeyup:q(A,["enter"])},{prefix:a(()=>[e(d,null,{default:a(()=>[e(m(U))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"狀態"},{default:a(()=>[e(B,{modelValue:n.status,"onUpdate:modelValue":t[2]||(t[2]=o=>n.status=o),placeholder:"請選擇狀態",clearable:"",class:"search-select"},{default:a(()=>[e(x,{label:"有效",value:"有效"}),e(x,{label:"無效",value:"無效"})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(p,{type:"primary",onClick:A,icon:m(U)},{default:a(()=>[...t[13]||(t[13]=[c(" 查詢 ",-1)])]),_:1},8,["icon"]),e(p,{onClick:$,icon:m(ae)},{default:a(()=>[...t[14]||(t[14]=[c("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),te((N(),L(H,{data:T.value,stripe:"",class:"data-table",style:{width:"100%"},"default-sort":{prop:"id",order:"ascending"},"row-class-name":G},{default:a(()=>[e(i,{prop:"id",label:"ID",width:"80",sortable:""}),e(i,{prop:"vendorName",label:"供應商名稱","min-width":"180",sortable:""}),e(i,{prop:"taxId",label:"稅號",width:"150",sortable:""}),e(i,{prop:"contactPerson",label:"聯繫人",width:"120"}),e(i,{prop:"bankAcctNo",label:"銀行帳號",width:"180"}),e(i,{prop:"settlementCurrency",label:"結算貨幣",width:"120"},{default:a(({row:o})=>[o.settlementCurrency?(N(),L(P,{key:0,type:"info",size:"small"},{default:a(()=>[c(D(o.settlementCurrency),1)]),_:2},1024)):(N(),R("span",me,"-"))]),_:1}),e(i,{prop:"status",label:"狀態",width:"100"},{default:a(({row:o})=>[e(P,{type:o.status==="有效"?"success":"danger"},{default:a(()=>[c(D(o.status),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"操作",width:"180",fixed:"right"},{default:a(({row:o})=>[e(p,{type:"primary",size:"small",icon:m(le),onClick:W=>K(o),class:"action-button"},{default:a(()=>[...t[15]||(t[15]=[c(" 編輯 ",-1)])]),_:1},8,["icon","onClick"]),e(p,{type:"danger",size:"small",icon:m(oe),onClick:W=>F(o),class:"action-button"},{default:a(()=>[...t[16]||(t[16]=[c(" 刪除 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[Q,g.value]])]),_:1}),e(J,{modelValue:b.value,"onUpdate:modelValue":t[10]||(t[10]=o=>b.value=o),title:w.value,width:"600px","close-on-click-modal":!1,class:"form-dialog"},{footer:a(()=>[C("div",pe,[e(p,{onClick:t[9]||(t[9]=o=>b.value=!1)},{default:a(()=>[...t[17]||(t[17]=[c("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:O,loading:h.value},{default:a(()=>[...t[18]||(t[18]=[c(" 確定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[e(z,{ref_key:"formRef",ref:V,model:s,rules:S,"label-width":"120px",class:"form-content"},{default:a(()=>[e(u,{label:"供應商名稱",prop:"vendorName"},{default:a(()=>[e(f,{modelValue:s.vendorName,"onUpdate:modelValue":t[3]||(t[3]=o=>s.vendorName=o),placeholder:"請輸入供應商名稱",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"稅號",prop:"taxId"},{default:a(()=>[e(f,{modelValue:s.taxId,"onUpdate:modelValue":t[4]||(t[4]=o=>s.taxId=o),placeholder:"請輸入稅號（唯一）",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"聯繫人",prop:"contactPerson"},{default:a(()=>[e(f,{modelValue:s.contactPerson,"onUpdate:modelValue":t[5]||(t[5]=o=>s.contactPerson=o),placeholder:"請輸入聯繫人姓名",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"銀行帳號",prop:"bankAcctNo"},{default:a(()=>[e(f,{modelValue:s.bankAcctNo,"onUpdate:modelValue":t[6]||(t[6]=o=>s.bankAcctNo=o),placeholder:"請輸入銀行帳號",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"結算貨幣",prop:"settlementCurrency"},{default:a(()=>[e(f,{modelValue:s.settlementCurrency,"onUpdate:modelValue":t[7]||(t[7]=o=>s.settlementCurrency=o),placeholder:"例如：CNY, USD",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"狀態",prop:"status"},{default:a(()=>[e(B,{modelValue:s.status,"onUpdate:modelValue":t[8]||(t[8]=o=>s.status=o),placeholder:"請選擇狀態",style:{width:"100%"}},{default:a(()=>[e(x,{label:"有效",value:"有效"}),e(x,{label:"無效",value:"無效"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ge=de(fe,[["__scopeId","data-v-45884c36"]]);export{ge as default};
