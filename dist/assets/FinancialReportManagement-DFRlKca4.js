import{a as S,r as q,n as E,b as u,c as b,d,e as l,f as o,g as f,w as n,u as N,i as G,z as T,x as J,H as K,t as m,G as L,J as P,E as g}from"./index-CAVot8kD.js";import{_ as Q,r as W}from"./_plugin-vue_export-helper-CZBBfLPA.js";const X={class:"financial-report-management",style:{padding:"20px"}},Z={class:"page-header"},ee={class:"page-title"},te={key:0},oe={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ae={style:{margin:"0","font-size":"20px",color:"#303133"}},ne={style:{margin:"5px 0 0 0","font-size":"14px",color:"#909399"}},le={key:0},se={class:"amount-text"},re={style:{padding:"15px",background:"#f5f7fa","border-radius":"4px","margin-top":"20px"}},ie={style:{"text-align":"center"}},ue={class:"amount-text large positive"},pe={style:{"text-align":"center"}},ce={class:"amount-text large positive"},de={key:1},me={style:{padding:"15px",background:"#f5f7fa","border-radius":"4px","margin-top":"20px"}},_e={style:{"text-align":"center"}},fe={__name:"FinancialReportManagement",setup(ge){const a=S(null),y=S(!1),i=q({reportType:"BALANCE_SHEET",reportDate:new Date().toISOString().split("T")[0]}),B=E(()=>{if(!a.value||!a.value.sections)return[];const t=[];for(const[e,r]of Object.entries(a.value.sections))r.items&&r.items.length>0&&(r.items.forEach((s,v)=>{t.push({section:v===0?e:"",item:s.accountName||s.name||s.accountCode||s.code||"-",amount:s.balance||s.amount||0})}),r.subtotal!=null&&t.push({section:"",item:`${e}小计`,amount:r.subtotal,isSubtotal:!0}));return t}),M=E(()=>{if(!a.value||!a.value.sections)return[];const t=[];for(const[e,r]of Object.entries(a.value.sections))r.items&&r.items.length>0&&(r.items.forEach((s,v)=>{t.push({section:v===0?e:"",item:s.accountName||s.name||s.accountCode||s.code||"-",amount:s.balance||s.amount||0})}),r.subtotal!=null&&t.push({section:"",item:`${e}小计`,amount:r.subtotal,isSubtotal:!0}));return t}),I=E(()=>{if(!a.value)return!1;const t=a.value.totalAssets||0,e=a.value.totalLiabilitiesAndEquity||0;return Math.abs(Number(t)-Number(e))<.01}),p=t=>t==null?"0.00":Number(t).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),D=t=>t?typeof t=="string"?t:new Date(t).toLocaleDateString("zh-CN"):"-",R=t=>{const e=Number(t);return e>0?"amount-text positive":e<0?"amount-text negative":"amount-text"},V=()=>a.value?Number(a.value.netIncome||0)>=0?"positive":"negative":"",z=async()=>{if(!i.reportType){g.warning("请选择报表类型");return}if(!i.reportDate){g.warning("请选择报表日期");return}try{y.value=!0;const t=await W.generateReport({reportType:i.reportType,reportDate:i.reportDate});a.value=t,g.success("报表生成成功")}catch(t){console.error("生成报表失败:",t),g.error(t.message||"生成报表失败，请检查后端服务是否启动"),a.value=null}finally{y.value=!1}},O=()=>{i.reportType="BALANCE_SHEET",i.reportDate=new Date().toISOString().split("T")[0],a.value=null},Y=()=>{if(!a.value){g.warning("请先生成报表");return}const t=j(),e=new Blob([t],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.download=`${a.value.reportName}_${i.reportDate}.txt`,s.click(),URL.revokeObjectURL(r),g.success("报表导出成功")},j=()=>{if(!a.value)return"";let t=`${a.value.reportName}
`;return t+=`报表日期：${D(a.value.reportDate)}
`,t+="=".repeat(50)+`

`,i.reportType==="BALANCE_SHEET"?(t+="资产合计："+p(a.value.totalAssets)+`
`,t+="负债和权益合计："+p(a.value.totalLiabilitiesAndEquity)+`
`):t+="净利润："+p(a.value.netIncome)+`
`,t};return(t,e)=>{const r=u("el-icon"),s=u("el-option"),v=u("el-select"),x=u("el-form-item"),H=u("el-date-picker"),h=u("el-button"),U=u("el-form"),w=u("el-card"),_=u("el-table-column"),A=u("el-table"),C=u("el-col"),$=u("el-row"),k=u("el-alert"),F=u("el-empty");return d(),b("div",X,[l("div",Z,[l("h1",ee,[o(r,{class:"title-icon"},{default:n(()=>[o(N(G))]),_:1}),e[2]||(e[2]=f(" 财务报表生成 ",-1))]),e[3]||(e[3]=l("p",{class:"page-subtitle"},"生成资产负债表和利润表",-1))]),o(w,{class:"main-card",shadow:"hover"},{header:n(()=>[...e[4]||(e[4]=[l("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[l("span",{style:{"font-size":"18px","font-weight":"600"}},"报表生成")],-1)])]),default:n(()=>[o(w,{class:"form-card",shadow:"never",style:{"margin-bottom":"20px"}},{default:n(()=>[o(U,{model:i,"label-width":"120px",inline:!0},{default:n(()=>[o(x,{label:"报表类型",prop:"reportType"},{default:n(()=>[o(v,{modelValue:i.reportType,"onUpdate:modelValue":e[0]||(e[0]=c=>i.reportType=c),placeholder:"请选择报表类型",style:{width:"200px"}},{default:n(()=>[o(s,{label:"资产负债表",value:"BALANCE_SHEET"}),o(s,{label:"利润表",value:"INCOME_STATEMENT"})]),_:1},8,["modelValue"])]),_:1}),o(x,{label:"报表日期",prop:"reportDate"},{default:n(()=>[o(H,{modelValue:i.reportDate,"onUpdate:modelValue":e[1]||(e[1]=c=>i.reportDate=c),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),o(x,null,{default:n(()=>[o(h,{type:"primary",onClick:z,loading:y.value},{default:n(()=>[o(r,null,{default:n(()=>[o(N(J))]),_:1}),e[5]||(e[5]=f(" 生成报表 ",-1))]),_:1},8,["loading"]),o(h,{onClick:O},{default:n(()=>[...e[6]||(e[6]=[f("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a.value?(d(),b("div",te,[o(w,{class:"report-card",shadow:"never"},{header:n(()=>[l("div",oe,[l("div",null,[l("h2",ae,m(a.value.reportName),1),l("p",ne," 报表日期："+m(D(a.value.reportDate)),1)]),o(h,{type:"success",onClick:Y},{default:n(()=>[o(r,null,{default:n(()=>[o(N(P))]),_:1}),e[7]||(e[7]=f(" 导出报表 ",-1))]),_:1})])]),default:n(()=>[i.reportType==="BALANCE_SHEET"?(d(),b("div",le,[o(A,{data:B.value,border:"",style:{width:"100%","margin-bottom":"20px"},"show-header":!0},{default:n(()=>[o(_,{prop:"section",label:"项目",width:"300"}),o(_,{prop:"item",label:"科目","min-width":"200"}),o(_,{prop:"amount",label:"金额",width:"200",align:"right"},{default:n(({row:c})=>[l("span",se,m(p(c.amount)),1)]),_:1})]),_:1},8,["data"]),l("div",re,[o($,{gutter:20},{default:n(()=>[o(C,{span:12},{default:n(()=>[l("div",ie,[e[8]||(e[8]=l("strong",null,"资产合计：",-1)),l("span",ue,m(p(a.value.totalAssets)),1)])]),_:1}),o(C,{span:12},{default:n(()=>[l("div",pe,[e[9]||(e[9]=l("strong",null,"负债和权益合计：",-1)),l("span",ce,m(p(a.value.totalLiabilitiesAndEquity)),1)])]),_:1})]),_:1}),I.value?(d(),T(k,{key:0,type:"success",closable:!1,style:{"margin-top":"15px"}},{default:n(()=>[...e[10]||(e[10]=[f(" 资产负债表平衡：资产合计 = 负债和权益合计 ",-1)])]),_:1})):(d(),T(k,{key:1,type:"warning",closable:!1,style:{"margin-top":"15px"}},{default:n(()=>[...e[11]||(e[11]=[f(" 资产负债表不平衡，请检查数据 ",-1)])]),_:1}))])])):i.reportType==="INCOME_STATEMENT"?(d(),b("div",de,[o(A,{data:M.value,border:"",style:{width:"100%","margin-bottom":"20px"}},{default:n(()=>[o(_,{prop:"section",label:"项目",width:"300"}),o(_,{prop:"item",label:"科目","min-width":"200"}),o(_,{prop:"amount",label:"金额",width:"200",align:"right"},{default:n(({row:c})=>[l("span",{class:L(R(c.amount))},m(p(c.amount)),3)]),_:1})]),_:1},8,["data"]),l("div",me,[l("div",_e,[e[12]||(e[12]=l("strong",null,"净利润：",-1)),l("span",{class:L([V(),"amount-text large"])},m(p(a.value.netIncome)),3)])])])):K("",!0)]),_:1})])):(d(),T(F,{key:1,description:"请选择报表类型和日期，然后点击「生成报表」","image-size":120}))]),_:1})])}}},ye=Q(fe,[["__scopeId","data-v-c17ca53a"]]);export{ye as default};
